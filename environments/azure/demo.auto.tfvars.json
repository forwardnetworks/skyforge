{
  "azure_global_resource_group": {
    "name": "rg-skyforge",
    "location": "westus2",
    "create_if_missing": true
  },
  "azure_regions": {
    "uswest2": {
      "cidr_block": "10.50.0.0/16",
      "ipv6_prefix": "2600:50::/56",
      "location": "westus2",
      "enable_virtual_wan": true,
      "enable_firewall": true,
      "virtual_hub_address_prefix": "10.50.240.0/24",
      "nat_gateways": [
        {
          "name": "shared-services-egress",
          "vnet_name": "shared-services",
          "public_subnet_tier": "frontend",
          "private_subnet_tiers": ["app", "data"]
        }
      ],
      "firewall_policy": {
        "network_rule_collections": [
          {
            "name": "skyforge-dmz-ingress",
            "priority": 200,
            "action": "Allow",
            "rules": [
              {
                "name": "allow-dmz-web",
                "source_addresses": ["10.50.32.0/20"],
                "destination_addresses": ["10.50.0.0/20"],
                "destination_ports": ["80", "443", "30080", "30443"],
                "protocols": ["TCP"],
                "description": "Allow DMZ ingress to application tier ports"
              },
              {
                "name": "allow-app-syslog",
                "source_addresses": ["10.50.0.0/20"],
                "destination_addresses": ["10.50.16.0/20"],
                "destination_ports": ["514", "6514"],
                "protocols": ["UDP", "TCP"],
                "description": "Forward application telemetry to inspection/logging"
              }
            ]
          },
          {
            "name": "skyforge-corp-mgmt",
            "priority": 220,
            "action": "Allow",
            "rules": [
              {
                "name": "allow-corp-to-management",
                "source_addresses": ["198.51.100.0/24", "203.0.113.0/24"],
                "destination_addresses": ["10.50.16.0/20"],
                "destination_ports": ["22", "443"],
                "protocols": ["TCP"],
                "description": "Permit corporate management traffic"
              }
            ]
          },
          {
            "name": "skyforge-deny-legacy",
            "priority": 400,
            "action": "Deny",
            "rules": [
              {
                "name": "deny-telnet",
                "source_addresses": ["*"],
                "destination_addresses": ["*"],
                "destination_ports": ["23"],
                "protocols": ["TCP"],
                "description": "Explicitly block legacy Telnet"
              }
            ]
          }
        ],
        "application_rule_collections": [
          {
            "name": "skyforge-app-egress",
            "priority": 300,
            "action": "Allow",
            "rules": [
              {
                "name": "allow-app-saas",
                "source_addresses": ["10.50.0.0/20"],
                "target_fqdns": [
                  "api.forwardnetworks.com",
                  "management.azure.com",
                  "login.microsoftonline.com"
                ],
                "protocols": [
                  { "type": "Https", "port": 443 }
                ],
                "description": "Allow application tier to reach SaaS control planes"
              }
            ]
          }
        ],
        "nat_rule_collections": [
          {
            "name": "skyforge-dnat-web",
            "priority": 250,
            "action": "Dnat",
            "rules": [
              {
                "name": "dnat-web-https",
                "source_addresses": ["*"],
                "destination_addresses": ["10.50.32.10"],
                "destination_ports": ["443"],
                "translated_address": "10.50.0.10",
                "translated_port": 443,
                "protocols": ["TCP"],
                "description": "Map public listener to internal web endpoint"
              }
            ]
          }
        ]
      },
      "vnet_peerings": [
        {
          "name": "shared-to-inspection",
          "vnet_a": "shared-services",
          "vnet_b": "inspection"
        }
      ],
      "vnets": {
        "shared-services": {
          "address_space": ["10.50.0.0/20"],
          "subnets_per_tier": 2,
          "tiers": ["frontend", "app", "data"],
          "enable_private_dns": true
        },
        "inspection": {
          "address_space": ["10.50.16.0/20"],
          "subnets_per_tier": 2,
          "tiers": ["ingress", "inspection", "egress"],
          "enable_private_dns": false
        },
        "app-services": {
          "address_space": ["10.50.32.0/20"],
          "subnets_per_tier": 2,
          "tiers": ["web", "api", "data"],
          "enable_private_dns": true
  }
},
  "azure_reachability": {
    "uswest2": {
      "tests": [
        {
          "name": "dmz-to-app-https",
          "source_address": "10.50.32.5",
          "destination_address": "10.50.0.10",
          "destination_port": 443,
          "description": "Check DMZ to shared-services HTTPS path"
        },
        {
          "name": "shared-to-logging-syslog",
          "source_address": "10.50.0.10",
          "destination_address": "10.50.16.10",
          "protocol": "Tcp",
          "destination_port": 6514,
          "description": "Validate syslog TLS egress to logging tier"
        }
      ]
    },
    "northeurope": {
      "tests": [
        {
          "name": "analytics-to-shared-sql",
          "source_address": "10.52.32.10",
          "destination_address": "10.52.0.15",
          "protocol": "Tcp",
          "destination_port": 1433,
          "description": "Analytics workload to shared SQL"
        }
      ]
    },
    "japaneast": {
      "tests": [
        {
          "name": "edge-to-shared-vpn",
          "source_address": "10.54.32.10",
          "destination_address": "10.54.0.10",
          "protocol": "Udp",
          "destination_port": 1194,
          "description": "Edge appliance to shared services VPN" 
        }
      ]
    }
  },
      "workloads": {
        "aks": {
          "vnet_name": "shared-services",
          "subnet_tier": "app",
          "node_count": 2,
          "node_vm_size": "Standard_DS2_v2"
        },
        "app_gateway": {
          "vnet_name": "shared-services",
          "subnet_tier": "frontend",
          "sku_name": "Standard_v2",
          "capacity": 2
        },
        "app_service": {
          "linux_runtime": true,
          "sku_name": "S1"
        },
        "storage": {
          "sku": "Standard_LRS",
          "kind": "StorageV2"
        },
        "sql": {
          "administrator_login": "skyforgeadmin"
        },
        "load_balancer": {
          "sku": "Standard",
          "type": "Public",
          "rules": [
            {
              "name": "tcp-80",
              "protocol": "Tcp",
              "frontend_port": 80,
              "backend_port": 80
            },
            {
              "name": "tcp-443",
              "protocol": "Tcp",
              "frontend_port": 443,
              "backend_port": 443
            }
          ],
          "health_probe": {
            "name": "http-probe",
            "protocol": "Http",
            "port": 80,
            "path": "/healthz",
            "interval_in_seconds": 10,
            "number_of_probes": 3
          }
        },
        "front_door": {
          "profile_name": "skyforge-demo-uswest2",
          "endpoint_name": "skyforge-westus2-endpoint",
          "origin_host": "app-skyforge-uswest2.azurewebsites.net",
          "origin_host_header": "app-skyforge-uswest2.azurewebsites.net",
          "health_probe_path": "/",
          "forwarding_protocol": "HttpsOnly",
          "https_redirect_enabled": true
        }
      }
    },
    "northeurope": {
      "cidr_block": "10.52.0.0/16",
      "ipv6_prefix": "2600:52::/56",
      "location": "northeurope",
      "enable_virtual_wan": true,
      "enable_firewall": false,
      "virtual_hub_address_prefix": "10.52.240.0/24",
      "nat_gateways": [
        {
          "name": "shared-services-egress",
          "vnet_name": "shared-services",
          "public_subnet_tier": "frontend",
          "private_subnet_tiers": ["app", "data"]
        }
      ],
      "asa_nva": {
        "vnet_name": "inspection",
        "subnet_tier": "inspection",
        "vm_size": "Standard_D4s_v5",
        "admin_username": "asaadmin"
      },
      "vnet_peerings": [
        {
          "name": "shared-to-inspection",
          "vnet_a": "shared-services",
          "vnet_b": "inspection"
        }
      ],
      "vnets": {
        "shared-services": {
          "address_space": ["10.52.0.0/20"],
          "subnets_per_tier": 2,
          "tiers": ["frontend", "app", "data"],
          "enable_private_dns": true
        },
        "inspection": {
          "address_space": ["10.52.16.0/20"],
          "subnets_per_tier": 2,
          "tiers": ["ingress", "inspection", "egress"],
          "enable_private_dns": false
        },
        "analytics": {
          "address_space": ["10.52.32.0/20"],
          "subnets_per_tier": 2,
          "tiers": ["etl", "warehouse", "bi"],
          "enable_private_dns": true
        }
      },
      "workloads": {
        "app_gateway": {
          "vnet_name": "shared-services",
          "subnet_tier": "frontend",
          "sku_name": "Standard_v2",
          "capacity": 2
        },
        "app_service": {
          "linux_runtime": true,
          "sku_name": "S1"
        },
        "storage": {},
        "load_balancer": {
          "sku": "Standard",
          "type": "Internal",
          "frontend": {
            "vnet_name": "shared-services",
            "subnet_tier": "app",
            "private_ip_address": "10.52.2.100"
          },
          "rules": [
            {
              "name": "internal-https",
              "protocol": "Tcp",
              "frontend_port": 443,
              "backend_port": 8443,
              "idle_timeout": 10
            }
          ],
          "health_probe": {
            "name": "internal-probe",
            "protocol": "Tcp",
            "port": 8443,
            "interval_in_seconds": 10,
            "number_of_probes": 3
          }
        }
      }
    },
    "japaneast": {
      "cidr_block": "10.54.0.0/16",
      "ipv6_prefix": "2600:54::/56",
      "location": "japaneast",
      "enable_virtual_wan": true,
      "enable_firewall": false,
      "virtual_hub_address_prefix": "10.54.240.0/24",
      "nat_gateways": [
        {
          "name": "shared-services-egress",
          "vnet_name": "shared-services",
          "public_subnet_tier": "frontend",
          "private_subnet_tiers": ["app", "data"]
        }
      ],
      "vnet_peerings": [
        {
          "name": "shared-to-inspection",
          "vnet_a": "shared-services",
          "vnet_b": "inspection"
        }
      ],
      "vnets": {
        "shared-services": {
          "address_space": ["10.54.0.0/20"],
          "subnets_per_tier": 2,
          "tiers": ["frontend", "app", "data"],
          "enable_private_dns": true
        },
        "inspection": {
          "address_space": ["10.54.16.0/20"],
          "subnets_per_tier": 2,
          "tiers": ["ingress", "inspection", "egress"],
          "enable_private_dns": false
        },
        "edge": {
          "address_space": ["10.54.32.0/20"],
          "subnets_per_tier": 2,
          "tiers": ["ingress", "processing", "egress"],
          "enable_private_dns": false
        }
      },
      "workloads": {
        "storage": {},
        "load_balancer": {
          "sku": "Standard",
          "type": "Public",
          "rules": [
            {
              "name": "udp-1194",
              "protocol": "Udp",
              "frontend_port": 1194,
              "backend_port": 1194
            }
          ],
          "health_probe": {
            "name": "vpn-probe",
            "protocol": "Tcp",
            "port": 1194,
            "interval_in_seconds": 5,
            "number_of_probes": 2
          }
        }
      }
    }
  }
}
